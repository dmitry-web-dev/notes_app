name: Security Gate

on:
  pull_request:
    branches: [main]

jobs:
  security:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Security Scan
      run: |
        # Устанавливаем Bandit
        pip install bandit
        
        # Сканируем код
        if bandit -r . --severity-level HIGH 2>&1 | grep -q "HIGH"; then
          echo "CRITICAL VULNERABILITIES FOUND"
          echo "::error::Merge blocked: Security vulnerabilities detected"
          exit 1
        fi
        
        # Проверяем debug режим
        if grep -r "debug\s*=\s*True" . --include="*.py" 2>/dev/null; then
          echo "DEBUG MODE ENABLED"
          echo "::error::Merge blocked: debug=True found in production"
          exit 1
        fi
        
        echo "Security checks passed"