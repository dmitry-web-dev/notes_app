name: Security Check

on: [pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install Bandit
        run: pip install bandit
      
      - name: Run Bandit with config
        run: |
          echo "Running Bandit with configuration..."
          
          if [ -f ".bandit" ]; then
            echo "Using .bandit configuration file"
            bandit -c .bandit .
          else
            # Сканируем только наши файлы
            echo "Scanning specific files..."
            bandit app.py tests/test_security.py --severity-level high
          fi
          
          if [ $? -ne 0 ]; then
            echo "::error::MERGE BLOCKED: Security issues found!"
            exit 1
          fi
      
      - name: Check for debug mode
        run: |
          echo "Checking for debug=True..."
          if grep -q "debug\s*=\s*True" app.py; then
            echo "::error::MERGE BLOCKED: debug=True found!"
            exit 1
          fi